<!DOCTYPE html>
<html>

<head>
    <title>在线漫画阅读器</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
</head>

<body>

    <div class="control" style="width:100%;">
        <button onclick="previous()" style="height:20px;"><-</button>
        <button onclick="next()" style="height:20px;float:right;">-></button>
    </div>
    
    <img id="image" alt="image" src="" />
    
    <div class="control" style="width:100%;">
        <button onclick="previous()" style="height:20px;"><-</button>
        <button onclick="next()" style="height:20px;float:right;">-></button>
    </div>

    <script type="text/javascript">
    var data;
    var index = 0;
    getData();
    
    function getData(){
        var url = getURL();
        var xhr = new XMLHttpRequest();
        xhr.open('GET', url);
        xhr.onreadystatechange = function(){
            if(xhr.readyState === 4){
                console.log(xhr.status);
                console.log(xhr.responseText);
                data = JSON.parse(xhr.responseText);
                loadImage(0);
                console.log(data);
            }
        }
        xhr.send();
    }
    
    function getURL(){
        var url;
        var uniqueName = getQueryVariable("uniquename");
        if (uniqueName == "") {
            url = "./data.json";
            root = "./";
        }else{
            url = "/data/"+ uniqueName + "/data.json";
            root = "/data/"+ uniqueName;
        }
        
        return url;
    }
    
    function getQueryVariable(variable){
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
            var pair = vars[i].split("=");
            if(pair[0] == variable){return pair[1];}
        }
        return "";
    }
    
    function loadImage(offset){
        var images = data["images"];
        index = index + offset;
        index = Math.min(images.length - 1, index);
        index = Math.max(0, index);
        var imgUrl = root + "/" + images[index];
        document.getElementById("image").src=imgUrl;
    }
    
    function previous(){
        loadImage(-1);
    }
    
    function next(){
        loadImage(1);
    }
    
    </script>
</body>

</html>